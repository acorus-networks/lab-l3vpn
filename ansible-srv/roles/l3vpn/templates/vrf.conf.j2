#jinja2: lstrip_blocks: "True", trim_blocks: "True"

{% if l3vpn_connectors is defined %}
{% for name,connectors in l3vpn_connectors.items() %}

replace:
routing-instances vpn-{{ name|lower }} {
    instance-type vrf;
    {% if connectors is defined %}
    {% for connector in connectors %}
    interface {{ connector.interface }};
    {% endfor %}
    {% endif %}
    vrf-import vpn-{{ name|lower }}-in;
    vrf-export vpn-{{ name|lower }}-out;
    route-distinguisher {{ l3vpn_general.rd }}:{{ l3vpn_instances[name].id }};
    vrf-target target:{{ l3vpn_general.target }}:{{ l3vpn_instances[name].id }};
}

policy-options {
    replace:
    community VPN-{{ name|upper }} members target:{{ l3vpn_general.target }}:{{ l3vpn_instances[name].id }};
}

policy-options {
    replace:
    policy-statement vpn-{{ name|lower }}-in {
        term bgp {
            from {
                protocol bgp;
                community VPN-{{ name|upper }};
            }
            then accept;
        }
        then reject;
    }
}

policy-options {
    replace:
    policy-statement vpn-{{ name|lower }}-out {
        term bgp {
            from {
                protocol bgp;
            }
            then {
                community add VPN-{{ name|upper }};
                accept;
            }
        }
        then reject;
    }
}

{# for connector in l3vpn_connectors #}
{% endfor %}

{# endif l3vpn_connectors is defined #}
{% endif %}


